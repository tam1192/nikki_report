# commit: first_commit
この記事はgitを用いながらrustでプログラムを書いてみよう
っていう記事です。

## 使ってる環境
- macOS Sequoia
- vscode
- git 2.39.5 (Apple Git-154)
- rustc 1.83.0 (90b35a623 2024-11-26)
- cargo 1.83.0 (5ffbef321 2024-10-29)
- github

## 詳しく説明しないこと
- unixのコマンド(もしくはpwsh,cmdのコマンド)

## 無駄に詳しく説明すること
- rustの知識(ある意味rust布教記事でもある)

# commit: cargo initを実行
開発環境をセットアップして、最初のコミットをしよう。

## localリポジトリをセットアップ

rustのプロジェクトを作ります。
とりあえずディレクトリを作成してそこに移動

```
cargo init .
```
を実行すると、いい感じにセットアップしてくれます。
```
.
├── Cargo.toml
└── src
    └── main.rs

```

この時点ですでに、gitのローカルリポジトリがセットアップされています。

#### 補足
cargoというのは、rust開発者を支援するツールです。
rust以外だと、cmake(c言語)、gradle(Java,Kotlin)、npm(nodejs)などがあります。

これらのツールは基本的に、外部ライブラリの整理(インストール)、ビルド支援（プログラム間の連携）をしてくれるわけです。

## githubにアクセスできるようにする

github上にリポジトリを作りましょう。

`git remote add`
する方法もあり、学びとしてはそっちの方が深いのですが、
正直こっちの方が楽

https://cli.github.com

一度githubのアカウントを作成しておけば、CLI上でログインするだけでgithubの機能をコマンド上からアクセス可能です。

**sshの鍵登録も不要！**

インストール後、
```
gh auth login --web
```
コマンドでgithubにログインします。

## githubにリポジトリを登録
一度ghコマンドを使えるようにすると、以降次の手順でgithubにリポジトリを作成可能です。

```
gh repo create 
```
対話式で様々な質問が出てきます。
```
What would you like to do? 
```
一番最初の質問で三択出てきますが
```
Push an existing local repository to GitHub
```
**(存在しているローカルリポジトリを、githubにpushする)**
を選択します。

その後はenter連打でいけます。

#### 注意
**Visibility をprivateにすると、非公開になります。** 公開するのが怖い場合は注意してください。

## コミットする
ここまできたらコミットします。

### コミットって何？
例えば、[blenderでサイコロを作る](https://blender-cg.net/dice/)とき...

![figure01:さいころを作る手順図](./figure/figure01.png)

上からステップごとに分かれていて、作業ステップが変わる度に
`git commmit -m <ここにコミットメッセージ>`
というコマンドを入力します。
こうすることで、ファイルをいじった時、ファイルの変更にメッセージをつけて記録しておくことができます。

### コミット頻度はどうしよう
例えば、サイコロの形に変更が入った時...

![figure02:変更したさいころの手順書](./figure/figure02.png)

`git log`をたとって、あるコミットから分岐させることが可能になります。
（分岐の方法については後で記載します）

そう考えると、次の考え方ができます。
- コミット間に加えた変化が多いほど、戻しづらくなる
- しかし、コミットが多いほど、今度はログが見辛くなる

（例えば、サイコロの穴を開ける時、穴一つ一つ毎にコミットすれば、20コミット増えます）

しかも、`git log`した時、得られる情報はメッセージのみです。
![figure03:手順書(文字列のみ)](./figure/figure03.png)
そう考えると、
- コミットメッセージは丁寧にした方が良い
  
となるわけです。


コミットの頻度についてはこれらの記事が参考になると思います。
https://qiita.com/kozyty@github/items/87fa95a236b6142f7c10
https://qiita.com/jnchito/items/40e0c7d32fde352607be

...参考にしてるのかよく分からないですが、
今回は **「変更が一行で説明できる範囲内で１コミット」** を目標に
頑張ります。

### ところで
もちろんblenderでもgitは使えます。（blenderにターミナルついてないから相性は良くないかもだけど）
何なら、パワポ、ワード、エクセルといった3種の仁義、
その他etc...

gitのメリットの一つ **バイナリファイルが扱える** です。

(この記事も下敷きはgit使ってます)

### 実際に行ってみる
実際にコミットします。
まずはプロジェクトの一番浅いところで次のコマンドを実行
`git add .`

意味は次の章で説明

`git commit -m "cargo initを実行"`
**これでコミットができます。**
first commit? 邪道です、ちゃんとやったことを書く
（こだわり強く生きる）

## リモートにあげる
コミットしただけではリモート(github)に適用されません。

次のコマンドでリモートにアップロードできます。

まず、`git branch`を実行。

このコマンドで表示された文字列が`master`なら
`git push --set-upstream origin master`
このコマンドで表示された文字列が`main`なら
`git push --set-upstream origin main`

意味は後述

**二回目以降はこちら** 、理由は後述
`git push`

## logを確認
```
> git log
commit 6c57a4c498b7a817265563bb8e1c8b31ee1a3a7d (HEAD -> master, origin/master)
Author: nikki9750 <76221172+tam1192@users.noreply.github.com>
Date:   Sat Jan 11 17:42:06 2025 +0900

    cargo init を実行
```

commitの後ろに書いてあるハッシュみたいな文字列はコミットハッシュです。
識別子。　さっきみたいにコミット戻す時に使います。

- `HEAD`は頭。 今触っているところ。
- `master(main)`はブランチと言います。
- `origin`はリモートの名前です。　
- `Author` コミットした人
- `Date` コミットした日付

これで最初の作業は終了です。　

### ブランチ
![figure04: ブランチ解説](./figure/figure04.png)
図のように、ログを切り分けることができます。
**左から右に、ブランチを作成しています。（ブランチを切るという）**
**右から左の矢印は、切ったブランチから変更を適用しています。**

一度作成したブランチは消すまで存在し続けます。
別のブランチで加えた変更は、様々な方法で別のブランチで適用ができます。

ブランチのメリットは、触りながら理解できればいいかなと思います。

### mainとmaster(変更は任意)
masterが差別用語に該当するとかで、mainという言い方に切り替わっています。[(参考)](https://www.itmedia.co.jp/news/articles/2007/13/news057.html)

**masterブランチは、これ以降mainに統一して説明します。**

私の環境では、cargoが生成するgitリポジトリのデフォルトブランチが"master"なので、gitに触れるついでに変更しておきます。

今いるブランチをmasterにして、 
```
git branch -m main
``` 
で変更。

`-m`はブランチ名の変更を意味するそう。

そのままpushしようとすると
```
fatal: The upstream branch of your current branch does not match
the name of your current branch.  To push to the upstream branch
on the remote, use

    git push origin HEAD:master

To push to the branch of the same name on the remote, use

    git push origin HEAD

To choose either option permanently, see push.default in 'git help config'.

To avoid automatically configuring an upstream branch when its name
won't match the local branch, see option 'simple' of branch.autoSetupMerge
in 'git help config'.
```
と出るので、その通りに
```
git push origin HEAD 
```

しかし、リモート側に新規作成されるだけで、変更にはならないので...
![image01-01](./image/image01-01.png)
githubのSettingsにアクセスし
![image01-02](./image/image01-02.png)
![image01-03](./image/image01-03.png)
Default branchを変更
![image01-04](./image/image01-04.png)
![image01-05](./image/image01-05.png)
その後、masterブランチを削除する

これで解決...**しない**
ローカルの方でも変更が必要。

```
> git branch -a
* main
  remotes/origin/main
  remotes/origin/master
```
`-a`オプションは、隠しブランチ的な存在を表示してくれる。
`remote`というのはその名通りリモートのこと。
リモートとローカルは、その性質上ズレが生じる。それをうまいこと解決してくれるブランチなのだが、masterが居残る。

```
git fetch --prune
```
を実行すると、masterが消えてくれる
```
> git branch -a
* main
  remotes/origin/main
  remotes/origin/master
```

試してないから知らんが、`git branch -d /remotes/origin/master`よりは安全と見た。

